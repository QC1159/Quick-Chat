<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Avatar</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        img, svg {
            width: 100%;
            height: 100%;
            object-fit: cover; /* if it's an image */
        }

        /* Transparent overlay */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent; /* invisible */
            user-select: none;       /* prevent text/image selection */
            pointer-events: all;     /* block clicks/interaction */
            z-index: 9999;           /* ensure it's on top */
        }
    </style>
</head>
<body>
<div id="overlay"></div> <!-- overlay div -->

<script>
    const params = new URLSearchParams(location.search);
    let username = params.get("u") || null;
    const room = params.get("r") || null;
    const roomName = params.get("rn") || room;
    if (!username && !room) {
        username = "User";
    }

    let imgUrl = null;
    if (username) {
        imgUrl = `https://raw.githubusercontent.com/QC1159/Quick-Chat-Account-Images/refs/heads/main/${username}.png`;
    } else {
        imgUrl = `https://raw.githubusercontent.com/QC1159/Quick-Chat-Account-Images/refs/heads/main/rooms/${room}.png`;
    }

    function hash(key, seed = 0) {
        let remainder = key.length & 3;
        let bytes = key.length - remainder;
        let h1 = seed;
        let c1 = 0xcc9e2d51;
        let c2 = 0x1b873593;
        let i = 0;

        while (i < bytes) {
            let k1 =
                (key.charCodeAt(i) & 0xff) |
                ((key.charCodeAt(++i) & 0xff) << 8) |
                ((key.charCodeAt(++i) & 0xff) << 16) |
                ((key.charCodeAt(++i) & 0xff) << 24);
            ++i;

            k1 = (((k1 * c1) >>> 0) & 0xffffffff);
            k1 = ((k1 << 15) | (k1 >>> 17)) >>> 0;
            k1 = (((k1 * c2) >>> 0) & 0xffffffff);

            h1 ^= k1;
            h1 = ((h1 << 13) | (h1 >>> 19)) >>> 0;
            h1 = (((h1 * 5) >>> 0) + 0xe6546b64) >>> 0;
        }

        let k1 = 0;
        switch (remainder) {
            case 3: k1 ^= (key.charCodeAt(i + 2) & 0xff) << 16;
            case 2: k1 ^= (key.charCodeAt(i + 1) & 0xff) << 8;
            case 1: k1 ^= (key.charCodeAt(i) & 0xff);
                k1 = (((k1 * c1) >>> 0) & 0xffffffff);
                k1 = ((k1 << 15) | (k1 >>> 17)) >>> 0;
                k1 = (((k1 * c2) >>> 0) & 0xffffffff);
                h1 ^= k1;
        }

        h1 ^= key.length;
        h1 ^= h1 >>> 16;
        h1 = (((h1 * 0x85ebca6b) >>> 0) & 0xffffffff);
        h1 ^= h1 >>> 13;
        h1 = (((h1 * 0xc2b2ae35) >>> 0) & 0xffffffff);
        h1 ^= h1 >>> 16;

        return h1 >>> 0;
    }

    function gradientSVG(name) {
        const h = Math.abs(hash(name, 1));
        const h2 = Math.abs(hash(name, 0));
        const hue1 = h % 360;
        const hue2 = (h + 45) % 360;
        const angle = h2 % 360;
        const radians = (angle * Math.PI) / 180;

        const x1 = 0.5 - 0.5 * Math.cos(radians);
        const y1 = 0.5 - 0.5 * Math.sin(radians);
        const x2 = 0.5 + 0.5 * Math.cos(radians);
        const y2 = 0.5 + 0.5 * Math.sin(radians);

        const initial = name[0].toUpperCase();

        return `
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice">
    <defs>
      <linearGradient id="grad" x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}">
        <stop offset="0%" stop-color="hsl(${hue1}, 100%, 50%)"/>
        <stop offset="100%" stop-color="hsl(${hue2}, 100%, 50%)"/>
      </linearGradient>
    </defs>
    <rect width="100" height="100" fill="url(#grad)"/>
    <text
      x="50%"
      y="50%"
      text-anchor="middle"
      dominant-baseline="central"
      font-size="400%"
      fill="white"
      font-family="sans-serif"
    >
      ${initial}
    </text>
  </svg>
`;
    }

    function solidColorSVG(room) {
        const h = Math.abs(hash(room, 1));
        const hue = h % 360;

        const initial = room[0].toUpperCase();

        return `
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice">
            <rect width="100" height="100" fill="hsl(${hue}, 100%, 50%)"/>
            <text
              x="50%"
              y="50%"
              text-anchor="middle"
              dominant-baseline="central"
              font-size="400%"
              fill="white"
              font-family="sans-serif"
            >
              ${initial}
            </text>
          </svg>
        `;
    }

    if (username) {
        document.body.insertAdjacentHTML("afterbegin", gradientSVG(username));
    } else {
        document.body.insertAdjacentHTML("afterbegin", solidColorSVG(roomName));
    }

    const img = new Image();
    img.onload = () => {
        document.body.insertAdjacentHTML("afterbegin", `<img src="${imgUrl}" width="200" height="200" style="display:block;">`);
    };
    img.onerror = () => {};
    img.src = imgUrl;
</script>
</body>
</html>
